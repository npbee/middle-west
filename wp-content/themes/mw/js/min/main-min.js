var mwm=function($,e,s){var t=$(e).width(),o=$(" #mobile__menu__button "),a=$(" nav ul "),n=$(" .sub-nav ul a"),r=function(){return t>=768?!0:!1},l=function(e,s){var t=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;if(""==e)return $(".error--invalid").fadeOut(300),$(".error--empty").fadeIn(300),$("input#email").focus(),!1;if(!t.test(e))return $(".error--empty").fadeOut(100),$(".error--invalid").fadeIn(300),$("input#email").focus(),!1;var o=$(".mailing-list form").serialize();return $.ajax({type:"POST",url:"../../php/mailing-list-submit.php",data:o,success:function(){var e="<div class='thanks'>Thanks!</div>";$(".error").hide(),$(e).hide().appendTo("footer").fadeIn(300).delay(1e3).fadeOut(300),$(".mailing-list form").each(function(){this.reset()})},error:function(){$("footer").append("<div class='submit-error error'>There was an error processing this</div>")}}),!1},p={init:function(e,s){var t,o;"home"==s&&r()?(t=5,o="<a class='load-more-posts'>Load More Posts</a>"):"home"==s?(t=3,o="<a class='load-more-posts'>Load More Posts</a>"):(t=2,o="<a class='read-more-posts' target='_blank' href='http://middlewestmgmt.tumblr.com/tagged/"+e+"'>Read More Posts</a>"),this.getPosts(t,e,o)},getPosts:function(e,s,t){var o=$(".news article").length,a;$.ajax({type:"GET",dataType:"jsonp",url:"http://api.tumblr.com/v2/blog/middlewestmgmt.tumblr.com/posts?api_key=5cHAhSpCdCiLOdeoWeJAAwCbqFUW4LCvfe9GxwVJXWcgUH4XSl&offset="+o+"&limit="+e+"&tag="+s,data:{get_param:"value"},success:function(s){p.display(s,0,e,t)}})},display:function(e,s,t,o){for(var a=0;t>a;a++)!function(s){var t=e.response.posts[s].date,o=t.split("-"),n=o[2].split(" "),i=o[0],r=o[1],l=n[0],p=e.response.posts[s].tags;$(".news .news-feed").append(function(){var t=$("<article/>"),o=$("<h3/>",{"class":"post-title",text:e.response.posts[s].title}),n=$("<div/>",{"class":"post-date",text:r+"/"+l+"/"+i}),d=$("<div/>",{html:e.response.posts[s].body}),c=$("<div/>",{"class":"post-meta"});$.each(p,function(t,o){c.append("<span><a target='_blank' href='http://middlewestmgmt.tumblr.com/tagged/"+e.response.posts[s].tags[t]+"''>"+e.response.posts[s].tags[t]+"</span>")});var m=$("<span/>",{html:"<span><a href="+e.response.posts[a].post_url+" target='_blank'>permalink</a></span>"});return c.append(m),t.append(o),t.append(n),t.append(d),t.append(c),t}),$(".news").fitVids({customSelector:"iframe[src*='nbc.com']"})}(a);$(".news .news-feed").append(o)},loadMore:function(e){$(".load-more-posts").live("click",function(){var e=$(".news article").length,s=e+1,t=$(this),o;$(this).addClass("loading"),$.ajax({type:"GET",dataType:"jsonp",url:"http://api.tumblr.com/v2/blog/middlewestmgmt.tumblr.com/posts?api_key=5cHAhSpCdCiLOdeoWeJAAwCbqFUW4LCvfe9GxwVJXWcgUH4XSl&offset="+s+"&tag="+mwmTumblr.tag,data:{get_param:"value"},success:function(e){for(e.response.blog.posts-s<=5?(o="",console.log("true")):o="<a class='load-more-posts'>Load More Posts</a>",i=0;i<5;i++)!function(s){var t=e.response.posts[s].date,o=t.split("-"),a=o[2].split(" "),n=o[0],r=o[1],l=a[0],p=e.response.posts[s].tags;$(".news .news-feed").append(function(){var t=$("<article/>"),o=$("<h3/>",{"class":"post-title",text:e.response.posts[s].title}),a=$("<div/>",{"class":"post-date",text:r+"/"+l+"/"+n}),d=$("<div/>",{html:e.response.posts[s].body}),c=$("<div/>",{"class":"post-meta"});$.each(p,function(t,o){c.append("<span><a target='_blank' href='http://middlewestmgmt.tumblr.com/tagged/"+e.response.posts[s].tags[t]+"''>"+e.response.posts[s].tags[t]+"</span>")});var m=$("<span/>",{html:"<span><a href="+e.response.posts[i].post_url+" target='_blank'>permalink</a></span>"});return c.append(m),t.append(o),t.append(a),t.append(d),t.append(c),t}),$(".news").fitVids({customSelector:"iframe[src*='nbc.com']"})}(i),t.addClass("destroy");$(".news").fitVids({customSelector:"iframe[src*='nbc.com']"}),$(".news .scrollable").append(o)}})})}};return{init:function(){console.log(isMobile())},colorbox:function(){r()&&($(" .colorbox ").colorbox({rel:"group",returnFocus:!1}),$(" .colorbox-extContent ").colorbox({iframe:!0,width:"80%",height:"80%",rel:"group-videos",transition:"none",reposition:!1}))},mobileAlbum:function(){r()||($(" .thumb-container ").on("click",function(e){var s=$(this).next();$(s).toggleClass("show"),e.preventDefault()}),$(" .mobile-album-info-close ").on("click",function(){$(" .mobile-album-info ").removeClass("show")}))},expander:function(){$(" .expandable ").expander({expandText:"more",userCollapseText:"less",expandSpeed:400,collapseSpeed:400,moreClass:"read-more",lessClass:"read-less",slicePoint:800})},flexslider:function(){$(" .flexslider ").flexslider({animation:"slide",useCSS:!0}),$(" .flexslider-mini ").flexslider({animation:"slide",slideshow:!1,useCSS:!0,start:function(){mwm.colorbox()}})},lazyload:function(){$(" img.lazy ").unveil(500)},mobileNav:function(){o.on("click",function(e){a.toggleClass("mobile__menu--open"),e.preventDefault()}),n.on("click",function(){var s=$(this).attr("href");a.removeClass("mobile__menu--open"),$("html, body").stop().animate({scrollTop:$(s).offset().top},400,"swing",function(){e.location.hash=s})})},mailingList:function(){var e=$("input#email").val(),s=$("#oid").val();$(" #submit ").on("click",function(e){e.preventDefault();var s=$("input#email").val(),t=$("#oid").val();l(s,t)})},scrollable:function(){$(" .news .scrollable ").scroll(function(){var e=$(this),s=$(this).scrollTop();s>=1?$(this).parent().addClass("bordered").addClass("no-fade"):$(this).parent().removeClass("bordered")})},soundcloud:function(){r()&&$.stratus({links:"https://soundcloud.com/middlewestmgmt/sets/middlewestmgmt-com"})},tumblr:function(){var e=mwmTumblr.tag,s=$(" body ").attr("class");p.init(e,s),p.loadMore()},profile:function(){var e=$(".js-profile-card");e.on("click",".profile-card__photo-wrapper",function(e){var s=$(this);s.addClass("profile-card--open");var t=s.parent("div").find(".profile-card__close");t.show(),t.on("click",function(e){s.removeClass("profile-card--open"),$(this).hide()})})}}}(window.jQuery,window,document);$(function(){mwm.colorbox(),mwm.mobileAlbum(),mwm.expander(),mwm.flexslider(),mwm.lazyload(),mwm.mobileNav(),mwm.scrollable(),mwm.soundcloud(),mwm.tumblr(),mwm.profile()});