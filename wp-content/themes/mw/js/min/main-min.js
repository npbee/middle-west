var mwm=function($,e,t){var s=$(e).width(),o=$(" #mobile__menu__button "),a=$(" nav ul "),n=$(" .sub-nav ul a"),l=function(){return s>=768?!0:!1},r=function(e,t){var s=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;if(""==e)return $(".error--invalid").fadeOut(300),$(".error--empty").fadeIn(300),$("input#email").focus(),!1;if(!s.test(e))return $(".error--empty").fadeOut(100),$(".error--invalid").fadeIn(300),$("input#email").focus(),!1;var o=$(".mailing-list form").serialize();return $.ajax({type:"POST",url:"../../php/mailing-list-submit.php",data:o,success:function(){var e="<div class='thanks'>Thanks!</div>";$(".error").hide(),$(e).hide().appendTo("footer").fadeIn(300).delay(1e3).fadeOut(300),$(".mailing-list form").each(function(){this.reset()})},error:function(){$("footer").append("<div class='submit-error error'>There was an error processing this</div>")}}),!1},p={init:function(e,t){var s,o;"home"==t&&l()?(s=5,o="<a class='load-more-posts'>Load More Posts</a>"):"home"==t?(s=3,o="<a class='load-more-posts'>Load More Posts</a>"):(s=2,o="<a class='read-more-posts' target='_blank' href='http://middlewestmgmt.tumblr.com/tagged/"+e+"'>Read More Posts</a>"),this.getPosts(s,e,o)},getPosts:function(e,t,s){var o=$(".news article").length,a;$.ajax({type:"GET",dataType:"jsonp",url:"http://api.tumblr.com/v2/blog/middlewestmgmt.tumblr.com/posts?api_key=5cHAhSpCdCiLOdeoWeJAAwCbqFUW4LCvfe9GxwVJXWcgUH4XSl&offset="+o+"&limit="+e+"&tag="+t,data:{get_param:"value"},success:function(t){p.display(t,0,e,s)}})},display:function(e,t,s,o){for(var a=0;s>a;a++)!function(t){var s=e.response.posts[t].date,o=s.split("-"),n=o[2].split(" "),i=o[0],l=o[1],r=n[0],p=e.response.posts[t].tags;$(".news .news-feed").append(function(){var s=$("<article/>"),o=$("<h3/>",{"class":"post-title",text:e.response.posts[t].title}),n=$("<div/>",{"class":"post-date",text:l+"/"+r+"/"+i}),d=$("<div/>",{html:e.response.posts[t].body}),m=$("<div/>",{"class":"post-meta"});$.each(p,function(s,o){m.append("<span><a target='_blank' href='http://middlewestmgmt.tumblr.com/tagged/"+e.response.posts[t].tags[s]+"''>"+e.response.posts[t].tags[s]+"</span>")});var c=$("<span/>",{html:"<span><a href="+e.response.posts[a].post_url+" target='_blank'>permalink</a></span>"});return m.append(c),s.append(o),s.append(n),s.append(d),s.append(m),s}),$(".news").fitVids({customSelector:"iframe[src*='nbc.com']"})}(a);$(".news .news-feed").append(o)},loadMore:function(e){$(".load-more-posts").live("click",function(){var e=$(".news article").length,t=e+1,s=$(this),o;$(this).addClass("loading"),$.ajax({type:"GET",dataType:"jsonp",url:"http://api.tumblr.com/v2/blog/middlewestmgmt.tumblr.com/posts?api_key=5cHAhSpCdCiLOdeoWeJAAwCbqFUW4LCvfe9GxwVJXWcgUH4XSl&offset="+t+"&tag="+mwmTumblr.tag,data:{get_param:"value"},success:function(e){for(e.response.blog.posts-t<=5?(o="",console.log("true")):o="<a class='load-more-posts'>Load More Posts</a>",i=0;i<5;i++)!function(t){var s=e.response.posts[t].date,o=s.split("-"),a=o[2].split(" "),n=o[0],l=o[1],r=a[0],p=e.response.posts[t].tags;$(".news .news-feed").append(function(){var s=$("<article/>"),o=$("<h3/>",{"class":"post-title",text:e.response.posts[t].title}),a=$("<div/>",{"class":"post-date",text:l+"/"+r+"/"+n}),d=$("<div/>",{html:e.response.posts[t].body}),m=$("<div/>",{"class":"post-meta"});$.each(p,function(s,o){m.append("<span><a target='_blank' href='http://middlewestmgmt.tumblr.com/tagged/"+e.response.posts[t].tags[s]+"''>"+e.response.posts[t].tags[s]+"</span>")});var c=$("<span/>",{html:"<span><a href="+e.response.posts[i].post_url+" target='_blank'>permalink</a></span>"});return m.append(c),s.append(o),s.append(a),s.append(d),s.append(m),s}),$(".news").fitVids({customSelector:"iframe[src*='nbc.com']"})}(i),s.addClass("destroy");$(".news").fitVids({customSelector:"iframe[src*='nbc.com']"}),$(".news .scrollable").append(o)}})})}};return{init:function(){console.log(isMobile())},colorbox:function(){l()&&($(" .colorbox ").colorbox({rel:"group",returnFocus:!1}),$(" .colorbox-extContent ").colorbox({iframe:!0,width:"80%",height:"80%",rel:"group-videos",transition:"none",reposition:!1}))},mobileAlbum:function(){l()||($(" .thumb-container ").on("click",function(e){var t=$(this).next();$(t).toggleClass("show"),e.preventDefault()}),$(" .mobile-album-info-close ").on("click",function(){$(" .mobile-album-info ").removeClass("show")}))},expander:function(){$(" .expandable ").expander({expandText:"more",userCollapseText:"less",expandSpeed:400,collapseSpeed:400,moreClass:"read-more",lessClass:"read-less",slicePoint:800})},flexslider:function(){$(" .flexslider ").flexslider({animation:"slide",useCSS:!0}),$(" .flexslider-mini ").flexslider({animation:"slide",slideshow:!1,useCSS:!0,start:function(){mwm.colorbox()}})},lazyload:function(){$(" img.lazy ").unveil(500)},mobileNav:function(){o.on("click",function(e){a.toggleClass("mobile__menu--open"),e.preventDefault()}),n.on("click",function(){var t=$(this).attr("href");a.removeClass("mobile__menu--open"),$("html, body").stop().animate({scrollTop:$(t).offset().top},400,"swing",function(){e.location.hash=t})})},mailingList:function(){var e=$("input#email").val(),t=$("#oid").val();$(" #submit ").on("click",function(e){e.preventDefault();var t=$("input#email").val(),s=$("#oid").val();r(t,s)})},scrollable:function(){$(" .news .scrollable ").scroll(function(){var e=$(this),t=$(this).scrollTop();t>=1?$(this).parent().addClass("bordered").addClass("no-fade"):$(this).parent().removeClass("bordered")})},soundcloud:function(){l()&&$.stratus({links:"https://soundcloud.com/middlewestmgmt/sets/middlewestmgmt-com"})},tumblr:function(){var e=mwmTumblr.tag,t=$(" body ").attr("class");p.init(e,t),p.loadMore()},profile:function(){var e=$(".js-profile-card");e.each(function(e,t){var s=$(this).attr("data-twitter-handle"),o=$(this).attr("data-instagram-handle");console.log(s,o)})}}}(window.jQuery,window,document);$(function(){mwm.colorbox(),mwm.mobileAlbum(),mwm.expander(),mwm.flexslider(),mwm.lazyload(),mwm.mobileNav(),mwm.mailingList(),mwm.scrollable(),mwm.soundcloud(),mwm.tumblr(),mwm.profile()});